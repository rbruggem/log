language: c

matrix:
  include:
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-4.6
            - lcov
      env: COMPILER=gcc-4.6 COVERALL_OPTS='--gcov gcov-4.6' TARGET=test
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-4.9
            - lcov
      env: COMPILER=gcc-4.9 COVERALL_OPTS='--gcov gcov-4.9' TARGET=test
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-5
            - lcov
      env: COMPILER=gcc-5 COVERALL_OPTS='--gcov gcov-5' TARGET=test
    - os: linux
      compiler: clang
      env: COMPILER=clang COVERALL_OPTS='' TARGET=test
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - lcov
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-4.9
            - valgrind
            - lcov
      env: COMPILER=gcc-4.9 COVERALL_OPTS='--gcov gcov-4.9' TARGET=test-valgrind
    - os: linux
      compiler: clang
      env: COMPILER=clang COVERALL_OPTS='' TARGET=test-valgrind
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - lcov
            - valgrind



script: CC=$COMPILER make gcov && CC=$COMPILER make $TARGET
after_success:
    - coveralls $COVERALL_OPTS --exclude test
before_install:
    - pip install --user urllib3[secure]
    - pip install --user cpp-coveralls
sudo: false
